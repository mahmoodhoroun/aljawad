<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_custom_payment_inherit" inherit_id="custom_invoice.report_custom_payment">
        <xpath expr="//div[@id='memo']" position="after">
            <div style="margin-top: 30px;" t-if="o.payment_invoice_ids">
                <div style="font-weight: bold; text-align: right; margin-bottom: 10px;">
                    <span>Invoice Details - تفاصيل الفواتير</span>
                </div>
                <table style="width: 100%; border-collapse: collapse; border: 1px solid #000; direction: rtl;">
                    <thead>
                        <tr style="background-color: #f5f5f5;">
                            <th style="border: 1px solid #000; padding: 8px; text-align: center;">Invoice Number<br/>رقم الفاتورة</th>
                            <th style="border: 1px solid #000; padding: 8px; text-align: center;">Origin<br/>المرجع</th>
                            <th style="border: 1px solid #000; padding: 8px; text-align: center;">Invoice Date<br/>تاريخ الفاتورة</th>
                            <th style="border: 1px solid #000; padding: 8px; text-align: center;">Due Date<br/>تاريخ الاستحقاق</th>
                            <th style="border: 1px solid #000; padding: 8px; text-align: center;">Total Amount<br/>المبلغ الإجمالي</th>
                            <th style="border: 1px solid #000; padding: 8px; text-align: center;">Residual<br/>المبلغ المتبقي</th>
                            <th style="border: 1px solid #000; padding: 8px; text-align: center;">Reconcile Amount<br/>مبلغ التسوية</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="o.payment_invoice_ids" t-as="invoice_line">
                            <tr>
                                <td style="border: 1px solid #000; padding: 5px; text-align: center;">
                                    <span t-esc="invoice_line.invoice_id.name"/>
                                </td>
                                <td style="border: 1px solid #000; padding: 5px; text-align: center;">
                                    <span t-esc="invoice_line.origin"/>
                                </td>
                                <td style="border: 1px solid #000; padding: 5px; text-align: center;">
                                    <span t-esc="invoice_line.date_invoice"/>
                                </td>
                                <td style="border: 1px solid #000; padding: 5px; text-align: center;">
                                    <span t-esc="invoice_line.date_due"/>
                                </td>
                                <td style="border: 1px solid #000; padding: 5px; text-align: center;">
                                    <span t-esc="invoice_line.amount_total" t-options="{'widget': 'monetary', 'display_currency': invoice_line.currency_id}"/>
                                </td>
                                <td style="border: 1px solid #000; padding: 5px; text-align: center;">
                                    <span t-esc="invoice_line.residual" t-options="{'widget': 'monetary', 'display_currency': invoice_line.currency_id}"/>
                                </td>
                                <td style="border: 1px solid #000; padding: 5px; text-align: center;">
                                    <span t-esc="invoice_line.reconcile_amount" t-options="{'widget': 'monetary', 'display_currency': invoice_line.currency_id}"/>
                                </td>
                            </tr>
                        </t>
                    </tbody>
                    <tfoot>
                        <tr style="background-color: #f0f0f0; font-weight: bold;">
                            <td colspan="5" style="border: 1px solid #000; padding: 5px; text-align: right;">
                                Total Residual - إجمالي المتبقي:
                            </td>
                            <td style="border: 1px solid #000; padding: 5px; text-align: center;">
                                <span t-esc="sum(o.payment_invoice_ids.mapped('residual'))" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                            </td>
                            <td style="border: 1px solid #000; padding: 5px; text-align: center;">
                                <span t-esc="sum(o.payment_invoice_ids.mapped('reconcile_amount'))" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                            </td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </xpath>
    </template>
</odoo>